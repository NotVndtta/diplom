<div class="container mx-auto px-4 py-8 max-w-7xl">
  <% if notice.present? %>
    <div class="mb-6 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg shadow-sm transition-all duration-300" role="alert" id="notice">
      <%= notice %>
    </div>
  <% end %>
  <% if alert.present? %>
    <div class="mb-6 bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg shadow-sm transition-all duration-300" role="alert" id="alert">
      <%= alert %>
    </div>
  <% end %>

  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Библиотека медиафайлов</h1>

    <%= link_to "Загрузить новый медиафайл",
      show_modal_media_files_path(@media_file),
      class: "bg-yellow-600 text-white px-5 py-2 rounded-lg shadow hover:bg-yellow-800 transition-colors duration-200 font-medium",
      data: { turbo_stream: "true" }
    %>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
    <% @media_files.each do |media_file| %>
      <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-all duration-300 flex flex-col">
        <div class="relative aspect-w-16 aspect-h-9 bg-gray-100">
          <% if media_file.file.file.resource_type == "image" %>
            <%= link_to media_file.file.url, class: "glightbox", data: { glightbox: "title: '#heets(File.basename(media_file.file.url)}'" } do %>
              <%= image_tag media_file.file.url, class: "w-full h-full object-cover", alt: "Media preview" %>
            <% end %>
          <% elsif media_file.file.file.resource_type == "video" %>
            <%= link_to media_file.file.url, class: "glightbox", data: { glightbox: "type: video", glightbox_video: "source: '#{media_file.file.url}', type: 'video/mp4'" } do %>
              <video muted class="w-full h-full object-cover pointer-events-none">
                <source src="<%= media_file.file.url %>" type="video/mp4">
              </video>
            <% end %>
          <% else %>
            <div class="w-full h-full flex items-center justify-center text-gray-600 px-2 text-sm">
              <p class="truncate"><%= File.basename(media_file.file.url) %></p>
            </div>
          <% end %>
        </div>

        <div class="p-4 flex-grow">
          <p class="text-sm text-gray-500 truncate"><%= File.basename(media_file.file.url.split('?').first) %></p>
        </div>

        <div class="p-4 border-t border-gray-100">
          <%= form_with url: attach_to_job_card_media_file_path(media_file), method: :post, class: "mb-2" do |form| %>
            <div class="flex items-center gap-2">
              <%= form.select :job_card_id, options_from_collection_for_select(@job_cards, :id, :farm_name, prompt: "Выберите агрооперацию"), { include_blank: "Выберите агрооперацию" }, class: "form-select w-full text-sm border-gray-300 rounded-md focus:ring-yellow-600 focus:border-yellow-600" %>
              <%= form.submit "Привязать", class: "bg-yellow-600 text-white px-3 py-1 rounded-md hover:bg-yellow-800 text-sm font-medium transition-colors duration-200" %>
            </div>
          <% end %>
          <%= link_to "Удалить", media_file_path(media_file), data: { turbo_method: :delete, turbo_confirm: "Вы уверены?" }, class: "text-red-600 hover:text-red-800 text-sm font-medium transition-colors duration-200" %>
        </div>
      </div>
    <% end %>
  </div>
</div>